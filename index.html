<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indique um Talento Excepcional! (Ajustes Finais)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-color: #0077b5; /* Azul LinkedIn */
            --secondary-color: #5e5e5e; 
            --light-secondary-color: #86888a; 
            --background-gradient-start: #eef2f7; 
            --background-gradient-end: #f8f9fa;   
            --card-background: #ffffff;
            --text-color: #333;
            --input-border-color: #ced4da;
            --success-color: #008000; 
            --font-family: 'Poppins', sans-serif;
            --border-radius: 10px; 
            --box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); 
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, var(--background-gradient-start) 0%, var(--background-gradient-end) 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
        }

        @keyframes fadeInContainer {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .container {
            background-color: var(--card-background);
            padding: 30px 40px 40px 40px; 
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border-top: 4px solid var(--primary-color); 
            width: 100%;
            max-width: 680px; 
            text-align: center;
            animation: fadeInContainer 0.7s ease-out forwards;
        }

        .header-image-container {
            margin-bottom: 20px;
            text-align: center;
        }

        .header-image-container img {
            max-width: 120px; 
            height: auto;
            border-radius: 50%; 
        }

        h1 {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 2.2em; 
            margin-top: 0; 
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            font-size: 1.0em; 
            color: var(--secondary-color);
            margin-bottom: 35px;
            max-width: 95%;
            margin-left: auto;
            margin-right: auto;
        }

        .form-group {
            margin-bottom: 25px; 
            text-align: left;
            position: relative;
        }
        
        /* Novo estilo para o grupo de input do LinkedIn com botão inline */
        .linkedin-input-group {
            display: flex;
            align-items: flex-start; /* Alinha o topo do input com o topo do botão */
            gap: 10px; /* Espaço entre o input e o botão */
        }
        .linkedin-input-group input[type="text"] {
            flex-grow: 1; /* Faz o input ocupar o espaço disponível */
        }
        .linkedin-input-group .assisted-search-button {
            margin-top: 0; /* Remove margem superior do botão se estiver inline */
            height: 47px; /* Ajustar altura para alinhar com o input */
            padding-top: 0;
            padding-bottom: 0;
            display: flex;
            align-items: center;
        }


        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px; 
            color: var(--text-color);
            font-size: 0.9em;
        }
         .form-group label .optional-text {
            font-weight: 400;
            color: var(--light-secondary-color);
            font-size: 0.9em;
        }

        .form-group input[type="text"],
        .form-group select {
            width: 100%;
            padding: 12px 15px; 
            border: 1px solid var(--input-border-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-family: var(--font-family);
            font-size: 0.95em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 119, 181, 0.20); 
            outline: none;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .checkbox-group .checkbox-option {
            background-color: #f8f9fa;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            border: 1px solid #e9ecef;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .checkbox-group .checkbox-option:hover {
            background-color: #eef2f7;
            border-color: #d0d9e3;
            transform: translateY(-2px);
        }
         .checkbox-group .checkbox-option input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.25);
            accent-color: var(--primary-color);
            flex-shrink: 0;
        }
        .checkbox-group .checkbox-option label {
            font-weight: 500;
            margin-bottom: 0;
            display: flex;
            align-items: center;
            width: 100%;
        }
        .checkbox-group .checkbox-option .emoji-func {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .checkbox-group .other-input {
            margin-top: 10px;
            padding-left: 0;
            grid-column: 1 / -1;
        }
        .checkbox-group .other-input input[type="text"]{
            font-size: 0.9em;
            padding: 10px 12px;
        }

        .form-instructions {
            font-size: 0.8em;
            color: var(--light-secondary-color);
            margin-top: -15px;
            margin-bottom: 12px;
        }

        .assisted-search-button {
            background-color: #e1e9ee; 
            color: #0077b5; 
            padding: 10px 15px;
            border: 1px solid #b0bace; 
            border-radius: var(--border-radius);
            font-size: 0.9em;
            font-weight: 600; 
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            /* margin-top: 10px; Removido para o caso inline */
            white-space: nowrap; /* Evita que o texto do botão quebre linha */
        }
        .assisted-search-button:hover {
            background-color: #d0d9e0;
            border-color: #909fae;
        }
        .assisted-search-button .emoji-search { 
             font-size: 1.1em; margin-right: 5px;
        }

        button[type="submit"], .new-referral-button { /* Estilo compartilhado */
            background: var(--primary-color); 
            color: white;
            padding: 16px 35px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,119,181,0.3);
            display: inline-block;
            width: auto;
            min-width: 220px;
            margin-top: 15px;
        }

        button[type="submit"]:hover, .new-referral-button:hover {
            background: #005e8e; 
            box-shadow: 0 6px 15px rgba(0,119,181,0.4);
            transform: translateY(-3px);
        }
        button[type="submit"]:active, .new-referral-button:active {
            transform: translateY(-1px);
        }
        button[type="submit"]:disabled {
            background: #a1aab3;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .new-referral-button { /* Estilo específico se necessário, ou pode ser só a classe */
            margin-top: 20px;
        }


        .emoji {
            font-size: 1.5em;
            margin-right: 8px;
            vertical-align: middle;
        }
        .thank-you-message {
            display: none;
            padding: 30px; 
            margin-top: 30px;
            background-color: #e6ffed;
            border: 1px solid var(--success-color);
            color: #155724;
            border-radius: var(--border-radius);
            text-align: center;
            animation: fadeInContainer 0.5s ease-out forwards;
        }
        .thank-you-message h2 {
            margin-top: 0;
            color: var(--success-color);
            font-size: 1.8em; 
        }
        .thank-you-message p {
            font-size: 1.1em; 
        }


        .tooltip-trigger {
            cursor: help;
            color: var(--primary-color);
            font-weight: bold;
            display: inline-block;
            margin-left: 8px;
            border: 1px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            line-height: 18px;
            text-align: center;
            font-size: 0.8em;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .tooltip-trigger:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .tooltip-content {
            position: absolute;
            background-color: #283e4a; 
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10;
            width: calc(100% - 30px);
            max-width: 300px;
            left: 50%;
            transform: translateX(-50%);
            bottom: calc(100% + 10px);
            font-size: 0.8rem;
            line-height: 1.4;
            text-align: left;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
            transform: translateX(-50%) translateY(10px);
        }
        .tooltip-content::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: #283e4a transparent transparent transparent;
        }
        .tooltip-content.visible {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .tooltip-content p { margin: 0 0 8px 0; }
        .tooltip-content strong { color: #70b5f9; } 

        @media (max-width: 768px) { /* Ajuste do breakpoint para o input inline */
            .linkedin-input-group {
                flex-direction: column; /* Empilha em telas menores */
                gap: 8px;
            }
            .linkedin-input-group .assisted-search-button {
                width: 100%; /* Botão ocupa largura total quando empilhado */
                justify-content: center; /* Centraliza o conteúdo do botão */
                 height: auto; 
                 padding-top: 10px;
                 padding-bottom: 10px;
            }
        }


        @media (max-width: 600px) {
            .container {
                padding: 20px 25px;
                border-top-width: 3px;
            }
            h1 {
                font-size: 1.9em;
            }
            .subtitle {
                font-size: 0.95em;
            }
            .header-image-container img {
                max-width: 100px;
            }
            button[type="submit"], .new-referral-button { /* Botão de nova indicação também */
                width: 100%;
            }
            .checkbox-group {
                grid-template-columns: 1fr;
            }
            .tooltip-content {
                width: 90%;
                bottom: auto;
                top: calc(100% + 10px);
            }
            .tooltip-content::after {
                top: -16px;
                border-color: transparent transparent #283e4a transparent;
            }
        }
        .spinner {
            display: inline-block;
            width: 1em;
            height: 1em;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 5px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header-image-container">
            <img src="https://placehold.co/120x120/0077b5/FFFFFF?text=Talento&font=poppins" alt="Ícone de Talento">
        </div>

        <h1><span class="emoji">🌟</span> Indique um Talento!</h1>
        <p class="subtitle">
            Sua visão pode ser a chave! Ajude um profissional incrível a encontrar novas trilhas e fortaleça nossa rede com os melhores talentos. É simples, rápido e impactante!
        </p>

        <form id="referralForm">
            <div class="form-group">
                <label for="indicatedName">Nome do(a) Profissional Indicado(a):</label>
                <input type="text" id="indicatedName" name="indicatedName" placeholder="Ex: Juliana Lima" required>
            </div>

            <div class="form-group">
                <label for="indicatedCompany">Empresa Atual / Última Empresa <span class="optional-text">(opcional, refina a busca no LinkedIn)</span>:</label>
                <input type="text" id="indicatedCompany" name="indicatedCompany" placeholder="Ex: Empresa Incrível S/A">
            </div>
            
            <div class="form-group">
                <label for="indicatedContact">
                    Link do Perfil no LinkedIn (encontrado na busca):
                    <span class="tooltip-trigger" id="tooltipTrigger" aria-describedby="linkedinHelp">[?]</span>
                </label>
                <div class="linkedin-input-group">
                    <input type="text" id="indicatedContact" name="indicatedContact" 
                           placeholder="Copie e cole o link do perfil aqui" 
                           pattern="https?://(www\.)?linkedin\.com/(in|pub)/.+|linkedin\.com/(in|pub)/.+"
                           title="Por favor, insira um link válido do LinkedIn (ex: https://linkedin.com/in/seuperfil)"
                           required>
                    <button type="button" class="assisted-search-button" onclick="openLinkedInSearchForProfile()">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" style="margin-right: 5px; vertical-align: middle;"><path d="M20.5 2h-17A1.5 1.5 0 002 3.5v17A1.5 1.5 0 003.5 22h17a1.5 1.5 0 001.5-1.5v-17A1.5 1.5 0 0020.5 2zM8 19H5v-9h3zM6.5 8.25A1.75 1.75 0 118.3 6.5a1.78 1.78 0 01-1.8 1.75zM19 19h-3v-4.74c0-1.42-.6-1.93-1.38-1.93A1.74 1.74 0 0013 14.19a.66.66 0 000 .14V19h-3v-9h2.9v1.3a3.11 3.11 0 012.7-1.4c1.55 0 3.36.86 3.36 3.66z"></path></svg>
                        Buscar
                    </button>
                </div>
                <div id="linkedinHelp" class="tooltip-content" role="tooltip">
                    <p><strong>Como copiar o link do perfil no LinkedIn:</strong></p>
                    <p><strong>📲 No Celular (App LinkedIn):</strong><br>
                    1. Vá ao perfil da pessoa.<br>
                    2. Toque nos três pontinhos (...) ou 'Mais'.<br>
                    3. Selecione 'Compartilhar perfil' ou 'Enviar perfil'.<br>
                    4. Escolha 'Copiar link'.</p>
                    <p><strong>💻 No Computador:</strong><br>
                    1. Abra o perfil no navegador.<br>
                    2. Copie o endereço (URL) da barra de navegação.</p>
                </div>
            </div>

            <div class="form-group">
                <label for="relationship">Minha relação profissional com ele(a) foi como:</label>
                <select id="relationship" name="relationship" required>
                    <option value="" disabled selected>Selecione uma opção</option>
                    <option value="colega_equipe">Colega na mesma equipe</option>
                    <option value="lider">Meu/Minha líder</option>
                    <option value="liderado">Meu/Minha liderado(a)</option>
                    <option value="projetos_juntos">Trabalhamos em projetos juntos</option>
                    <option value="outro">Outro</option>
                </select>
            </div>

            <div class="form-group">
                <label>Ele(a) brilharia mais em (escolha até 2 áreas):</label>
                 <div class="form-instructions">Sua perspectiva é muito valiosa!</div>
                <div class="checkbox-group">
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Vendas"><span class="emoji-func">📈</span> Vendas</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Estratégia & Negócios"><span class="emoji-func">🚀</span> Estratégia & Negócios</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Marketing & Comunicação"><span class="emoji-func">📣</span> Marketing & Comunicação</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Operações & Processos"><span class="emoji-func">⚙️</span> Operações & Processos</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Tecnologia & Dados"><span class="emoji-func">💻</span> Tecnologia & Dados</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Produto & UX"><span class="emoji-func">💡</span> Produto & UX</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Liderança & Gestão"><span class="emoji-func">👥</span> Liderança & Gestão</label></div>
                    <div class="checkbox-option"><label><input type="checkbox" name="areas" value="Finanças"><span class="emoji-func">💰</span> Finanças</label></div>
                    <div class="checkbox-option">
                        <label>
                            <input type="checkbox" name="areas" value="outra_area_chk" id="outraAreaChk"><span class="emoji-func">✨</span> Outra área
                        </label>
                         <div class="other-input" id="outraAreaInputContainer" style="display: none;">
                             <input type="text" id="outraAreaText" name="outra_area_text" placeholder="Qual área?">
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit"><span class="emoji">🚀</span> Enviar Indicação Agora</button>
        </form>
        <div id="thankYouMessage" class="thank-you-message">
            <h2><span class="emoji">🎉</span> Indicação Recebida!</h2>
            <p>Fantástico! Muito obrigado por sua contribuição. Juntos, construímos uma rede de talentos ainda mais forte!</p>
            <button type="button" class="new-referral-button" id="newReferralButton">Indicar Outro Talento</button>
        </div>
    </div>

    <script>
        // Configuração do Cliente Supabase com suas chaves reais
        const SUPABASE_URL = 'https://kyeyxkzvvxcypyjsfuzu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5ZXl4a3p2dnhjeXB5anNmdXp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxNDczNzAsImV4cCI6MjA2MjcyMzM3MH0.H3ZS35V1vxU9TLRAzi10kOiFdZcZtKlAX9bJ0DVKrAc';

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function openLinkedInSearchForProfile() {
            const name = document.getElementById('indicatedName').value.trim();
            const company = document.getElementById('indicatedCompany').value.trim();

            if (name === "") {
                alert("Por favor, preencha pelo menos o nome do indicado para a busca.");
                document.getElementById('indicatedName').focus();
                return;
            }

            let keywords = name; 
            if (company !== "") {
                keywords += ` ${company}`; 
            }

            const linkedInSearchUrl = `https://www.linkedin.com/search/results/people/?keywords=${encodeURIComponent(keywords)}&origin=GLOBAL_SEARCH_HEADER`;
            window.open(linkedInSearchUrl, '_blank');
        }

        const tooltipTrigger = document.getElementById('tooltipTrigger');
        const tooltipContent = document.getElementById('linkedinHelp');

        if (tooltipTrigger && tooltipContent) { 
            tooltipTrigger.addEventListener('click', (event) => {
                event.stopPropagation();
                tooltipContent.classList.toggle('visible');
            });
            tooltipTrigger.addEventListener('mouseover', () => {
                tooltipContent.classList.add('visible');
            });
            tooltipTrigger.addEventListener('mouseleave', () => {
                tooltipContent.classList.remove('visible');
            });
        }
        
        document.addEventListener('click', (event) => {
            if (tooltipTrigger && tooltipContent && 
                typeof tooltipTrigger.contains === 'function' && 
                typeof tooltipContent.contains === 'function' && 
                !tooltipTrigger.contains(event.target) && 
                !tooltipContent.contains(event.target)) {
                tooltipContent.classList.remove('visible');
            }
        });

        const checkboxesAreas = document.querySelectorAll('input[name="areas"]');
        const maxAreas = 2;

        checkboxesAreas.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                let checkedCount = 0;
                checkboxesAreas.forEach(cb => {
                    if (cb.checked) {
                        checkedCount++;
                    }
                });

                if (checkedCount > maxAreas) {
                    checkbox.checked = false;
                    alert(`Você pode selecionar no máximo ${maxAreas} áreas.`);
                }
            });
        });

        const outraAreaChk = document.getElementById('outraAreaChk');
        const outraAreaInputContainer = document.getElementById('outraAreaInputContainer');
        const outraAreaText = document.getElementById('outraAreaText');

        if (outraAreaChk && outraAreaInputContainer && outraAreaText) { 
            outraAreaChk.addEventListener('change', () => {
                if (outraAreaChk.checked) {
                    outraAreaInputContainer.style.display = 'block';
                    outraAreaText.required = true;
                } else {
                    outraAreaInputContainer.style.display = 'none';
                    outraAreaText.required = false;
                    outraAreaText.value = '';
                }
            });
        }

        const form = document.getElementById('referralForm');
        const thankYouMessage = document.getElementById('thankYouMessage');
        const newReferralButton = document.getElementById('newReferralButton');
        const submitButton = form.querySelector('button[type="submit"]'); // Pega o botão de submit original

        if (form && thankYouMessage && newReferralButton && submitButton) { 
            form.addEventListener('submit', async function(event) {
                event.preventDefault(); 
                
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = 'Enviando... <span class="spinner"></span>';

                const nomeIndicado = document.getElementById('indicatedName').value.trim();
                const empresaIndicado = document.getElementById('indicatedCompany').value.trim();
                const linkedinIndicado = document.getElementById('indicatedContact').value.trim();
                const relacaoProfissional = document.getElementById('relationship').value;
                
                const areasSelecionadas = [];
                document.querySelectorAll('input[name="areas"]:checked').forEach(checkbox => {
                    if (checkbox.value === 'outra_area_chk' && document.getElementById('outraAreaChk').checked) {
                        const outraAreaVal = document.getElementById('outraAreaText').value.trim();
                        if (outraAreaVal) areasSelecionadas.push(outraAreaVal);
                    } else if (checkbox.value !== 'outra_area_chk') {
                        areasSelecionadas.push(checkbox.value); 
                    }
                });

                const indicacaoData = {
                    nome_indicado: nomeIndicado,
                    empresa_indicado: empresaIndicado || null, 
                    linkedin_indicado: linkedinIndicado,
                    relacao_profissional: relacaoProfissional,
                    areas_destaque: areasSelecionadas.length > 0 ? areasSelecionadas : null
                };

                try {
                    const { data, error } = await supabaseClient 
                        .from('indicacoes') 
                        .insert([indicacaoData]);

                    if (error) {
                        console.error('Erro ao salvar indicação:', error);
                        alert(`Houve um erro ao enviar sua indicação: ${error.message}. Por favor, tente novamente.`);
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                        return; 
                    }
                    
                    form.reset(); 
                    form.style.display = 'none';
                    thankYouMessage.style.display = 'block';
                    thankYouMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Reabilitar o botão de submit principal para o caso de "nova indicação"
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;


                } catch (error) {
                    console.error('Erro inesperado na submissão:', error);
                    alert('Houve um erro inesperado ao processar sua indicação. Por favor, tente novamente.');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                }
            });

            newReferralButton.addEventListener('click', function() {
                thankYouMessage.style.display = 'none'; // Esconde a mensagem de agradecimento
                form.style.display = 'block'; // Mostra o formulário novamente
                // O form.reset() já foi chamado no submit, então ele estará limpo.
                // Focar no primeiro campo para conveniência
                document.getElementById('indicatedName').focus(); 
            });
        }
    </script>
</body>
</html>
